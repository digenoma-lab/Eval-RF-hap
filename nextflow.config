params{
    outdir="./temp"
    tool="both" //Could be "merqury", "yak" or "both"
    from_yak=true //If true, it will use the precomputed yak files, if false, it will count the kmers and evaluate with yak
    from_assembly=true //If true, it will use the precomputed hapmers, if false, it will assemble the hapmers
    from_meryl=true //If true, it will use the precomputed meryl files, if false, it will count the kmers
}

process{
    withName: "meryl_sr|meryl_lr"{
        container = "community.wave.seqera.io/library/meryl:1.3--b578ca97d10ad1dc"
        memory = "100G"
        cpus = 16
    }
    withName: "hapmers"{
        container = "community.wave.seqera.io/library/merqury:1.3--3dd862c6d2916492"
        memory = "40G"
        cpus = 16
    }
    withName: "seqtk"{
        container = "community.wave.seqera.io/library/seqtk_pigz:7b301904d63da1f1"
        memory = "40G"
        cpus = 16
    }
    withName: "merqury"{
        container = "community.wave.seqera.io/library/merqury:1.3--3dd862c6d2916492"
        memory = "80G"
        cpus = 60
    }
    withName: "hifiasm"{
        container = "community.wave.seqera.io/library/gfatools_hifiasm:5b6f41d32100879d"
        memory = "500G"
        cpus = 60
    }
    withName: "yak_count|yak_trioeval"{
        container = "community.wave.seqera.io/library/yak:0.1--331af83cbba56a8f"
        memory = "300G"
        cpus = 30
    }
    withName: "gfastats"{
        container = "community.wave.seqera.io/library/gfastats:1.3.11--692f8595aa6b06a8"
        memory = "16G"
        cpus = 8
    }
}

profiles {
    kutral {
        singularity.enabled     = true
        singularity.autoMounts  = true
	    singularity.runOptions = ' --bind /mnt/beegfs/labs/ '
        conda.enabled           = false
        docker.enabled          = false
        podman.enabled          = false
        shifter.enabled         = false
        charliecloud.enabled    = false
        apptainer.enabled       = false
        process.executor = 'slurm'
        process.queue = 'ngen-ko'
        executor.queueSize = 10
    }
    local {
        singularity.enabled     = true
        singularity.autoMounts  = true
	    singularity.runOptions = ' --bind /mnt/beegfs/labs/ '
        conda.enabled           = false
        docker.enabled          = false
        podman.enabled          = false
        shifter.enabled         = false
        charliecloud.enabled    = false
        apptainer.enabled       = false
    }
    
    stub {

        process {
            withName: '.*' {
                cpus   = 1
                memory = '1 MB'
                time   = '5 min'
            }
        }
        docker.enabled = false
        singularity.enabled = false
        conda.enabled = false
        podman.enabled = false
        shifter.enabled = false
        charliecloud.enabled = false
        apptainer.enabled = false
    }
}
def trace_timestamp = new java.util.Date().format( 'yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file    = "${params.outdir}/pipeline_info/execution_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file    = "${params.outdir}/pipeline_info/pipeline_dag_${trace_timestamp}.html"
}
manifest {
    defaultBranch = 'main'
    author = 'Gabriel Cabas'
    version = '0.0.1'
}